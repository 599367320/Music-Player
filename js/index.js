"use strict";!function(e,n){function t(t){this.wrapper=t,this.dataList=[],this.indexObj=null,this.timer=null,this.curIndex=0,this.list=null}t.prototype={init:function(){this.getDom(),this.getData("../mock/data.json")},getDom:function(){this.record=document.querySelector(".song-img img"),this.controlBtns=document.querySelectorAll(".control li")},getData:function(t){var s=this;e.ajax({url:t,method:"GET",success:function(t){s.dataList=t,s.listPlay(),s.indexObj=new n.controlIndex(t.length),s.loadMusic(s.indexObj.index),s.musicControl(),s.drag()},error:function(){}})},loadMusic:function(t){var s=this.dataList[t];n.render(s),n.music.load(s.audioSrc),n.progress.pro.renderAllTime(s.duration),"play"==n.music.status&&(n.music.play(),this.controlBtns[2].className="pause",this.imgRotate(0),n.progress.pro.move(0)),this.list.changeSelect(t),this.curIndex=t},musicControl:function(){var s=this;this.controlBtns[1].addEventListener("touchend",function(){n.music.status="play",s.loadMusic(s.indexObj.prev())}),this.controlBtns[2].addEventListener("touchend",function(){var t;"play"==n.music.status?(n.music.pause(),s.controlBtns[2].className="",s.imgStop(),n.progress.pro.stop()):(n.music.play(),s.controlBtns[2].className="pause",t=s.record.dataset.rotate||0,s.imgRotate(t),n.progress.pro.move())}),this.controlBtns[3].addEventListener("touchend",function(){n.music.status="play",s.loadMusic(s.indexObj.next())})},imgRotate:function(t){var s=this;clearInterval(this.timer),this.timer=setInterval(function(){t=+t+.2,s.record.style.transform="rotate("+t+"deg)",s.record.dataset.rotate=t},1e3/60)},imgStop:function(){clearInterval(this.timer)},listPlay:function(){var e=this;this.list=n.listControl(this.dataList,this.wrapper),this.controlBtns[4].addEventListener("touchend",function(){e.list.slideUp()}),this.list.musicList.forEach(function(t,s){t.addEventListener("touchend",function(){s!=e.curIndex&&(n.music.status="play",e.indexObj.index=s,e.loadMusic(s),e.list.slideDown())})})},drag:function(){var i=this,t=n.progress.drag(document.querySelector(".circle"));t.start=function(){n.progress.pro.stop()},t.move=function(t){n.progress.pro.update(t,!0)},t.end=function(t){var s=i.dataList[i.curIndex].duration*t;n.music.playTo(s),n.music.play(),n.progress.pro.move(t);var e=i.record.dataset.rotate||0;i.imgRotate(e),i.controlBtns[2].className="pause"}}},new t(document.getElementById("box")).init()}(window.Zepto,window.player);